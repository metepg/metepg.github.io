function initFields(){for(let e=15;e<55;e++){const t=document.getElementById("pituus"),n=document.createElement("option");n.value=e,n.innerText=`${e} päivää`,28==e&&(n.selected=!0),t.appendChild(n)}for(let e=1;e<=10;e++){const t=document.getElementById("vuotopvt"),n=document.createElement("option");n.value=e,n.innerText=e,t.appendChild(n)}}Date.prototype.getWeek=function(e){e="int"==typeof e?e:0;var t=new Date(this.getFullYear(),0,1),n=t.getDay()-e;n=n>=0?n:n+7;var a,o=Math.floor((this.getTime()-t.getTime()-6e4*(this.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)+1;return n<4?(a=Math.floor((o+n-1)/7)+1)>52&&(nYear=new Date(this.getFullYear()+1,0,1),nday=nYear.getDay()-e,nday=nday>=0?nday:nday+7,a=nday<4?1:53):a=Math.floor((o+n-1)/7),a};const fp=flatpickr("#flatpickr",{});function addEvents(){const e=document.getElementById("lastCycle").value,t=document.getElementById("pituus").value,n=document.getElementById("vuotopvt").value,a=+e.split(".")[0],o=+e.split(".")[1]-1,d=+e.split(".")[2];let l=[],r=1;for(i=0;i<300;i++){const e=new Date(d,o,a+i).toLocaleDateString("fi-FI",{day:"numeric",month:"numeric",year:"numeric"});r>t&&(r=1),l.push({date:e,title:r,bleed:r<=n}),r++}sessionStorage.setItem("events",JSON.stringify(l))}function calendarDaysJS(e){const t=[],n=new Date(e.getTime());for(n.setDate(2);1!=n.getDay();)n.setDate(n.getDate()-1);for(let e=1;e<=42;e++){const a=n.getDate(),o=n.getMonth(),d=n.getFullYear(),l=new Date(n).getWeek(),r=new Date(d,o,a),i=r.getWeek();r.setDate(r.getDate()-20),t[e]={day:a,month:o,year:d,date:`${n.getDate()}.${n.getMonth()+1}.${n.getFullYear()}`,week:l,primo:r,primoWeek:i},n.setDate(n.getDate()+1)}return t}function dateClass(e,t,n){let a=e.month===t?"active-day":"inactive-day";return e.day===n.getDate()&&e.month===n.getMonth()&&e.year===n.getFullYear()&&(a+=" current"),a+=" date"}function changeMonth(e,t){t.setMonth(t.getMonth()+e,1)}flatpickr("#lastCycle",{locale:"fi",dateFormat:"d.m.Y",allowInput:!0}),addEvents(),initFields();const months=["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],days=["MA","TI","KE","TO","PE","LA","SU"],today=new Date,dateForMonth=new Date(today.getTime());function renderCalendar(){let e=JSON.parse(sessionStorage.getItem("events"));document.querySelector(".calendar-year").textContent=dateForMonth.getFullYear(),document.querySelector(".current-month").textContent=months[dateForMonth.getMonth()],document.querySelectorAll(".date").forEach(e=>e.remove()),calendarDaysJS(dateForMonth).forEach((t,n)=>{const a=document.createElement("span"),o=document.createElement("div"),d=document.createElement("div");if(a.className="events",d.setAttribute("class",dateClass(t,dateForMonth.getMonth(),today)),e){const n=e.find(e=>e.date==`${t.date}`);n&&(n.bleed&&(d.classList.add("bleed"),a.classList.add("bleed-text")),a.innerText=n.title)}function l(e){document.getElementById(e).innerText=`VKO ${t.week}`}switch(o.classList.add("calendarDay"),o.textContent=t.day,o.setAttribute("aria-disabled","true"),n){case 1:l("week0");break;case 8:l("week1");break;case 15:l("week2");break;case 23:l("week3");break;case 30:l("week4");break;case 37:l("week5")}d.appendChild(a),d.appendChild(o);const r=new Date(t.primo).getDate(),i=new Date(t.primo).getMonth(),s=new Date(t.primo).getDay(),c=document.createElement("div");c.innerText=`${r}.${i+1==0?12:i+1}\n${void 0===days[s-1]?"SU":days[s-1]}`,c.style.visibility="hidden",d.addEventListener("click",()=>{o.classList.toggle("off"),a.classList.toggle("off"),"hidden"==c.style.visibility?(c.style.visibility="visible",c.style.opacity=1,c.style.color="black",c.style.marginTop="10px",d.style.backgroundColor="#f7ede2"):(c.style.visibility="hidden",d.style.backgroundColor="#fff"),console.log(`${r}.${i} ${void 0===days[s-1]?"SU":days[s-1]}`)}),d.appendChild(c),document.querySelector(".calendar-dates").appendChild(d)})}days.forEach(e=>{const t=document.createElement("span");t.textContent=e,document.querySelector(".calendar-days").appendChild(t)}),document.getElementById("prev").addEventListener("click",()=>{changeMonth(-1,dateForMonth),renderCalendar()}),document.getElementById("next").addEventListener("click",()=>{changeMonth(1,dateForMonth),renderCalendar()}),document.addEventListener("change",e=>{let t=e.target.id;"lastCycle"!=t&&"pituus"!=t&&"vuotopvt"!=t||(addEvents(),renderCalendar())}),renderCalendar();